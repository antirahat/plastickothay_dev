      - name: Send Email Alert (SMTP)
        if: steps.ping_server.outputs.success == 0
        run: |
          sudo apt-get update
          sudo apt-get install -y msmtp mailutils

          echo "defaults" > ~/.msmtprc
          echo "auth on" >> ~/.msmtprc
          echo "tls on" >> ~/.msmtprc
          echo "tls_trust_file /etc/ssl/certs/ca-certificates.crt" >> ~/.msmtprc
          echo "account default" >> ~/.msmtprc
          echo "host smtp.gmail.com" >> ~/.msmtprc
          echo "port 587" >> ~/.msmtprc
          echo "user ${{ secrets.EMAIL_USER }}" >> ~/.msmtprc
          echo "from ${{ secrets.EMAIL_USER }}" >> ~/.msmtprc
          echo "password ${{ secrets.EMAIL_PASS }}" >> ~/.msmtprc
          chmod 600 ~/.msmtprc

          MESSAGE=$(cat <<EOF
Subject: ðŸš¨ Render Server DOWN - $(date -u +"%Y-%m-%d %H:%M:%S UTC")
To: ${{ secrets.ALERT_EMAIL_1 }}, ${{ secrets.ALERT_EMAIL_2 }}

âš ï¸ Your Render server is DOWN.

Details:
- URL: ${{ secrets.APP_URL }}
- Last HTTP Code: ${{ steps.ping_server.outputs.last_http_code }}
- Time: $(date -u +"%Y-%m-%d %H:%M:%S UTC")

This alert was generated automatically by GitHub Actions.
EOF
)

          echo "$MESSAGE" | msmtp -v ${{ secrets.ALERT_EMAIL_1 }}
          echo "$MESSAGE" | msmtp -v ${{ secrets.ALERT_EMAIL_2 }}
